<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TypeScript Showcase</title>

    <!-- DaisyUI + Tailwind -->
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Ace Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ace.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.14/ext-language_tools.min.js" defer></script>

    <!-- TypeScript services (for possible future use) -->
    <script src="https://unpkg.com/typescript@latest/lib/typescriptServices.js" defer></script>

    <!-- Highlight.js for code blocks -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" defer></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      /* Small custom tweaks */
      .code-block {
        font-size: 0.9rem;
        white-space: pre-wrap;
      }
      .feature-card {
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }
      .feature-card:hover {
        transform: translateY(-6px) scale(1.01);
        box-shadow: 0 16px 40px rgba(8, 15, 52, 0.12);
      }
      .tab-active {
        border-bottom: 3px solid #0369a1;
        font-weight: 700;
        color: #034f84;
      }
      .article-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.45s ease-out;
      }
      .article-content.show {
        max-height: 2000px;
      }
      .nav-hidden {
        transform: translateY(-110%);
      }
      .nav-visible {
        transform: translateY(0);
      }
      #mobile-menu {
        transition: transform 0.28s ease-in-out;
      }

      /* Editor sizing */
      #ace-editor {
        width: 100%;
        height: 100%;
        min-height: 320px;
      }

      /* Chat UI */
      .chat-message.user {
        background: linear-gradient(90deg, rgba(56,189,248,0.08), rgba(99,102,241,0.06));
      }
      .chat-message.bot {
        background: rgba(255,255,255,0.03);
      }

      /* small mobile spacing */
      @media (max-width: 768px) {
        .hero-title { font-size: 1.9rem; }
      }
    </style>
  </head>
  <body class="bg-slate-50 min-h-screen text-slate-800 antialiased">
    <!-- Navigation -->
    <nav
      id="navbar"
      class="bg-white shadow-sm fixed top-0 w-full z-50 transition-transform duration-300 nav-visible"
      aria-label="Main navigation"
    >
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-3">
          <div class="flex items-center space-x-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-br from-sky-500 to-indigo-600 text-white">
              <i class="fas fa-code-branch"></i>
            </div>
            <div>
              <div class="text-lg font-bold">TypeScript Showcase</div>
              <div class="text-xs text-slate-500 -mt-1">Interactive learning & tools</div>
            </div>
          </div>

          <!-- Desktop links -->
          <div class="hidden md:flex items-center space-x-6">
            <a href="#features" class="text-slate-600 hover:text-sky-600 transition">Features</a>
            <a href="#examples" class="text-slate-600 hover:text-sky-600 transition">Examples</a>
            <a href="#tryit" class="text-slate-600 hover:text-sky-600 transition">Try It</a>
            <a href="#articles" class="text-slate-600 hover:text-sky-600 transition">Articles</a>
            <button id="chat-open-btn" class="btn btn-sm btn-outline">Chat AI</button>
          </div>

          <!-- Mobile menu button -->
          <button id="mobile-menu-button" onclick="toggleMobileMenu()" class="md:hidden btn btn-ghost" aria-label="Open menu">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </nav>

    <!-- Mobile Menu -->
    <div
      id="mobile-menu"
      class="md:hidden fixed top-16 left-0 w-full bg-white shadow-lg z-40 transform -translate-y-full"
      aria-hidden="true"
    >
      <div class="flex flex-col p-4 space-y-2">
        <a href="#features" class="text-slate-700 hover:text-sky-600 py-2" onclick="toggleMobileMenu()">Features</a>
        <a href="#examples" class="text-slate-700 hover:text-sky-600 py-2" onclick="toggleMobileMenu()">Examples</a>
        <a href="#tryit" class="text-slate-700 hover:text-sky-600 py-2" onclick="toggleMobileMenu()">Try It</a>
        <a href="#articles" class="text-slate-700 hover:text-sky-600 py-2" onclick="toggleMobileMenu()">Articles</a>
        <button id="chat-open-mobile" class="btn btn-sm btn-outline mt-2" onclick="openChat()">Chat AI</button>
      </div>
    </div>

    <!-- Hero -->
    <section class="pt-28 pb-12 bg-gradient-to-r from-sky-50 to-indigo-50">
      <div class="container mx-auto px-4 text-center">
        <h1 class="hero-title text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Professional TypeScript Showcase</h1>
        <p class="text-lg text-slate-600 max-w-3xl mx-auto mb-6">Explore advanced TypeScript features, live examples, a pro editor and an in-page AI assistant to help you learn faster.</p>
        <div class="flex justify-center gap-3">
          <a href="#tryit" class="btn btn-primary shadow-md">Try Examples</a>
          <a href="#features" class="btn btn-outline">Learn More</a>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section id="features" class="py-12">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center text-slate-800 mb-8">TypeScript Features</h2>
        <div class="grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
          <!-- cards -->
          <div class="feature-card card bg-white rounded-2xl p-5">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-lg bg-sky-100 flex items-center justify-center text-sky-600">
                <i class="fas fa-code"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold">Union Types</h3>
                <p class="text-slate-600 text-sm">Combine multiple types into one — great for flexible APIs and safer runtime checks.</p>
              </div>
            </div>
          </div>

          <div class="feature-card card bg-white rounded-2xl p-5">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-lg bg-emerald-100 flex items-center justify-center text-emerald-600">
                <i class="fas fa-shield-alt"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold">Type Guards</h3>
                <p class="text-slate-600 text-sm">Narrow types at runtime so your code can be both dynamic and type-safe.</p>
              </div>
            </div>
          </div>

          <div class="feature-card card bg-white rounded-2xl p-5">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-lg bg-violet-100 flex items-center justify-center text-violet-600">
                <i class="fas fa-link"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold">Optional Chaining</h3>
                <p class="text-slate-600 text-sm">Access nested props safely with `?.` and reduce null-check boilerplate.</p>
              </div>
            </div>
          </div>

          <div class="feature-card card bg-white rounded-2xl p-5">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-lg bg-yellow-100 flex items-center justify-center text-yellow-600">
                <i class="fas fa-cubes"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold">Generics</h3>
                <p class="text-slate-600 text-sm">Write reusable functions/components that preserve type information across types.</p>
              </div>
            </div>
          </div>

          <div class="feature-card card bg-white rounded-2xl p-5">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-lg bg-rose-100 flex items-center justify-center text-rose-600">
                <i class="fas fa-check-circle"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold">Type Assertions</h3>
                <p class="text-slate-600 text-sm">Tell the compiler what you know — useful when interfacing with third-party code.</p>
              </div>
            </div>
          </div>

          <div class="feature-card card bg-white rounded-2xl p-5">
            <div class="flex items-start gap-4">
              <div class="w-12 h-12 rounded-lg bg-indigo-100 flex items-center justify-center text-indigo-600">
                <i class="fas fa-filter"></i>
              </div>
              <div>
                <h3 class="text-lg font-semibold">Type Predicates</h3>
                <p class="text-slate-600 text-sm">Create custom runtime checks to refine types in conditional branches.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Articles (6 full articles) -->
    <section id="articles" class="py-12 bg-slate-50 border-t">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center text-slate-800 mb-8">TypeScript Articles</h2>

        <div class="space-y-6 max-w-4xl mx-auto">
          <!-- Article 1 -->
          <article class="bg-white rounded-xl shadow-md overflow-hidden">
            <header class="p-6 border-b cursor-pointer" onclick="toggleArticle(0)">
              <h3 class="text-xl font-semibold flex justify-between items-center">
                <span>Understanding Union Types in TypeScript</span>
                <i class="fas fa-chevron-down text-slate-400"></i>
              </h3>
            </header>
            <div class="article-content">
              <div class="p-6">
                <p class="text-slate-600 mb-4">Union types allow a variable to hold values of different types. They're defined with the pipe <code>|</code>.</p>
                <pre class="bg-slate-800 text-white p-4 rounded-lg mb-4"><code class="language-typescript">// Defining a union type
type ID = string | number;

function printID(id: ID) {
  if (typeof id === "string") {
    console.log(id.toUpperCase());
  } else {
    console.log(id.toFixed(2));
  }
}</code></pre>
                <p class="text-slate-600">Use unions in API responses or helpers where inputs may be one of several types.</p>
              </div>
            </div>
          </article>

          <!-- Article 2 -->
          <article class="bg-white rounded-xl shadow-md overflow-hidden">
            <header class="p-6 border-b cursor-pointer" onclick="toggleArticle(1)">
              <h3 class="text-xl font-semibold flex justify-between items-center">
                <span>Type Guards for Runtime Safety</span>
                <i class="fas fa-chevron-down text-slate-400"></i>
              </h3>
            </header>
            <div class="article-content">
              <div class="p-6">
                <p class="text-slate-600 mb-4">Type guards refine types during runtime, making code safer and clearer.</p>
                <pre class="bg-slate-800 text-white p-4 rounded-lg mb-4"><code class="language-typescript">// custom type guard
interface Bird { fly(): void; }
interface Fish { swim(): void; }

function isBird(pet: Bird | Fish): pet is Bird {
  return (pet as Bird).fly !== undefined;
}</code></pre>
                <p class="text-slate-600">Use type predicates <code>value is Type</code> to let TypeScript know what branch is active.</p>
              </div>
            </div>
          </article>

          <!-- Article 3 -->
          <article class="bg-white rounded-xl shadow-md overflow-hidden">
            <header class="p-6 border-b cursor-pointer" onclick="toggleArticle(2)">
              <h3 class="text-xl font-semibold flex justify-between items-center">
                <span>Optional Chaining & Nullish Coalescing</span>
                <i class="fas fa-chevron-down text-slate-400"></i>
              </h3>
            </header>
            <div class="article-content">
              <div class="p-6">
                <p class="text-slate-600 mb-4">Use <code>?.</code> and <code>??</code> to write concise, safe access and defaults.</p>
                <pre class="bg-slate-800 text-white p-4 rounded-lg mb-4"><code class="language-typescript">interface User {
  name: string;
  address?: { city?: string };
}

const city = (user: User) => user.address?.city ?? "Unknown";</code></pre>
                <p class="text-slate-600">Cleaner than long logical checks and helps readability.</p>
              </div>
            </div>
          </article>

          <!-- Article 4 -->
          <article class="bg-white rounded-xl shadow-md overflow-hidden">
            <header class="p-6 border-b cursor-pointer" onclick="toggleArticle(3)">
              <h3 class="text-xl font-semibold flex justify-between items-center">
                <span>Generics: Flexible & Typed</span>
                <i class="fas fa-chevron-down text-slate-400"></i>
              </h3>
            </header>
            <div class="article-content">
              <div class="p-6">
                <p class="text-slate-600 mb-4">Generics let you write reusable functions and components while preserving type info.</p>
                <pre class="bg-slate-800 text-white p-4 rounded-lg mb-4"><code class="language-typescript">function identity<T>(value: T): T {
  return value;
}

const v = identity<number>(42);</code></pre>
                <p class="text-slate-600">Great for collections, utility functions and generic components.</p>
              </div>
            </div>
          </article>

          <!-- Article 5 -->
          <article class="bg-white rounded-xl shadow-md overflow-hidden">
            <header class="p-6 border-b cursor-pointer" onclick="toggleArticle(4)">
              <h3 class="text-xl font-semibold flex justify-between items-center">
                <span>Type Assertions & Casting</span>
                <i class="fas fa-chevron-down text-slate-400"></i>
              </h3>
            </header>
            <div class="article-content">
              <div class="p-6">
                <p class="text-slate-600 mb-4">When you know more than the compiler, use assertions carefully to avoid runtime errors.</p>
                <pre class="bg-slate-800 text-white p-4 rounded-lg mb-4"><code class="language-typescript">const input = document.querySelector('#name') as HTMLInputElement;
console.log(input.value);</code></pre>
                <p class="text-slate-600">Prefer narrowing and guards over assertions when possible.</p>
              </div>
            </div>
          </article>

          <!-- Article 6 -->
          <article class="bg-white rounded-xl shadow-md overflow-hidden">
            <header class="p-6 border-b cursor-pointer" onclick="toggleArticle(5)">
              <h3 class="text-xl font-semibold flex justify-between items-center">
                <span>Type Predicates & Advanced Checks</span>
                <i class="fas fa-chevron-down text-slate-400"></i>
              </h3>
            </header>
            <div class="article-content">
              <div class="p-6">
                <p class="text-slate-600 mb-4">Create robust predicates when you need precise runtime checks.</p>
                <pre class="bg-slate-800 text-white p-4 rounded-lg mb-4"><code class="language-typescript">function isStringArray(value: any): value is string[] {
  return Array.isArray(value) && value.every(v => typeof v === 'string');
}</code></pre>
                <p class="text-slate-600">Useful for runtime validation before processing data.</p>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>

    <!-- Examples -->
    <section id="examples" class="py-12">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-6">TypeScript Examples</h2>

        <div class="tabs tabs-boxed justify-center mb-6 bg-white p-1 rounded-lg max-w-2xl mx-auto">
          <button class="tab tab-active" onclick="showExample(0)">Union Types</button>
          <button class="tab" onclick="showExample(1)">Optional Chaining</button>
          <button class="tab" onclick="showExample(2)">Type Guards</button>
          <button class="tab" onclick="showExample(3)">Type Assertions</button>
          <button class="tab" onclick="showExample(4)">Generics</button>
        </div>

        <div class="bg-white rounded-xl shadow-lg overflow-hidden max-w-4xl mx-auto">
          <div class="p-6 border-b">
            <h3 class="text-xl font-semibold" id="example-title">Union Types Example</h3>
            <p class="text-slate-600 mt-2" id="example-description">Function that accepts both string and number types and returns different results based on the input type.</p>
          </div>
          <div class="p-6 bg-slate-800 text-white">
            <pre class="code-block"><code class="language-typescript" id="example-code">// union example code appears here</code></pre>
          </div>
          <div class="p-6 border-t">
            <div class="flex flex-col md:flex-row md:items-center gap-3">
              <input type="text" placeholder="Enter a string or number" class="input input-bordered flex-grow" id="example-input" />
              <button class="btn btn-primary" onclick="runExample()">Run Example</button>
            </div>
            <div class="mt-4 p-4 bg-slate-50 rounded-lg">
              <p class="text-slate-700 font-medium">Output:</p>
              <p id="example-output" class="mt-2 text-slate-800">// Results will appear here</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Try it + Editor + Chat -->
    <section id="tryit" class="py-12 bg-slate-50">
      <div class="container mx-auto px-4 max-w-6xl">
        <h2 class="text-3xl font-bold text-center mb-6">Try TypeScript Yourself</h2>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Editor Card -->
          <div class="bg-white rounded-xl shadow-md overflow-hidden flex flex-col">
            <div class="p-4 bg-gradient-to-r from-sky-500 to-indigo-600 text-white flex items-center justify-between">
              <div class="font-semibold">TypeScript Editor (Ace)</div>
              <div class="text-xs opacity-90">Mode: TypeScript (demo compile → JS)</div>
            </div>

            <div class="p-4 flex-1 min-h-[360px]">
              <!-- Ace editor container -->
              <div id="ace-editor" class="rounded-lg border border-slate-200"></div>
            </div>

            <div class="p-4 border-t bg-slate-50 flex gap-3">
              <button class="btn btn-primary" onclick="runEditorCode()">Run</button>
              <button class="btn btn-ghost" onclick="formatEditor()">Format (basic)</button>
              <button class="btn btn-outline" onclick="insertExampleIntoEditor(0)">Insert Union Example</button>
              <button class="btn btn-outline" onclick="insertExampleIntoEditor(4)">Insert Generics</button>
            </div>
          </div>

          <!-- Output + Chat -->
          <div class="bg-white rounded-xl shadow-md overflow-hidden flex flex-col">
            <div class="p-4 bg-slate-100 font-medium">Output</div>
            <div class="p-4 flex-1 overflow-auto">
              <pre id="output-code" class="whitespace-pre-wrap text-sm text-slate-800">// Output will appear here</pre>
            </div>

            <div class="p-4 border-t bg-slate-50">
              <div class="flex items-center gap-2 text-slate-600">
                <i class="fas fa-info-circle"></i>
                <span class="text-sm">Editor compiles TypeScript-like code by removing type annotations for demo only — not production safe.</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Chatbot Drawer (hidden by default) -->
    <div id="chat-drawer" class="fixed right-6 bottom-6 w-96 md:w-96 max-h-[70vh] bg-gradient-to-br from-white to-slate-50 rounded-2xl shadow-2xl border overflow-hidden transform translate-y-8 opacity-0 pointer-events-none transition-all z-50">
      <div class="flex items-center justify-between p-4 border-b">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-indigo-600 text-white flex items-center justify-center"><i class="fas fa-robot"></i></div>
          <div>
            <div class="font-semibold">TypeScript AI (Demo)</div>
            <div class="text-xs text-slate-500">Canned helper: quick tips & inserts</div>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button class="btn btn-ghost btn-sm" onclick="clearChat()">Clear</button>
          <button class="btn btn-ghost btn-sm" onclick="closeChat()"><i class="fas fa-times"></i></button>
        </div>
      </div>

      <div id="chat-body" class="p-4 overflow-auto" style="height:340px;">
        <!-- messages go here -->
      </div>

      <div class="p-4 border-t bg-white flex gap-2">
        <input id="chat-input" class="input input-bordered flex-1" placeholder="Ask: e.g. 'How to use generics?'" />
        <button class="btn btn-primary" onclick="sendChat()">Send</button>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-800 text-white py-10 mt-12">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <h4 class="text-lg font-semibold mb-2">TypeScript Showcase</h4>
            <p class="text-slate-300 text-sm">Interactive demos, editor and in-page assistant to help you learn TS faster.</p>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-2">Quick Links</h4>
            <ul class="text-slate-300 text-sm space-y-1">
              <li><a href="#features" class="hover:underline">Features</a></li>
              <li><a href="#examples" class="hover:underline">Examples</a></li>
              <li><a href="#tryit" class="hover:underline">Try It</a></li>
              <li><a href="#articles" class="hover:underline">Articles</a></li>
            </ul>
          </div>
          <div>
            <h4 class="text-lg font-semibold mb-2">Resources</h4>
            <ul class="text-slate-300 text-sm space-y-1">
              <li><a href="https://www.typescriptlang.org/" class="hover:underline">TypeScript Docs</a></li>
              <li><a href="https://github.com/microsoft/TypeScript" class="hover:underline">GitHub</a></li>
              <li><a href="https://www.typescriptlang.org/play" class="hover:underline">Playground</a></li>
            </ul>
          </div>
        </div>

        <div class="mt-8 text-center text-slate-400 text-sm">&copy; 2025 TypeScript Showcase. All rights reserved.</div>
      </div>
    </footer>

    <!-- Scripts -->
    <script>
      // Re-run highlight after DOM loads
      document.addEventListener('DOMContentLoaded', () => {
        if (window.hljs) {
          document.querySelectorAll('pre code').forEach((block) => {
            try { window.hljs.highlightElement(block); } catch (e) {}
          });
        }
      });

      // ----------------------------
      // Examples data and logic
      // ----------------------------
      const examples = [
        {
          title: "Union Types Example",
          description: "Function that accepts both string and number types and returns different results based on the input type.",
          code: `function reLengthOrNumber(name: string | number): number {
  if (typeof name === "string") { return name.length; }
  return (name as number) * (name as number);
}`,
          run: (input) => {
            try {
              const parsed = isNaN(input) ? input : Number(input);
              return reLengthOrNumber(parsed);
            } catch (e) { return "Error: " + e.message; }
          }
        },
        {
          title: "Optional Chaining Example",
          description: "Safely access nested properties with optional chaining.",
          code: `interface Address { city: string; }
interface User { name: string; address?: Address; }
const getAddressCity = (u: User) => u.address?.city ?? "No address";`,
          run: (input) => {
            try {
              const test = input === 'withAddress' ? { name: 'John', address: { city: 'NY' } } : { name: 'John' };
              return (function(person){ return person.address?.city ?? 'No address'; })(test);
            } catch (e) { return "Error: " + e.message; }
          }
        },
        {
          title: "Type Guards Example",
          description: "Using type guards to narrow down types.",
          code: `class Cat { meow(){ return "Meow!"; } }
function isCat(obj: any): obj is Cat { return obj instanceof Cat; }
function checkCat(obj: any){ return isCat(obj) ? "Cat yes" : "No cat"; }`,
          run: (input) => {
            try {
              return input === 'cat' ? (new Cat()).meow() : 'No cat';
            } catch (e) { return "Error: " + e.message; }
          }
        },
        {
          title: "Type Assertions Example",
          description: "Using assertions to cast types carefully.",
          code: `const el = document.createElement('input') as HTMLInputElement;
el.value = '42';
console.log(Number(el.value) + 8);`,
          run: (input) => 'Demo: check console in editor run output.'
        },
        {
          title: "Generics Example",
          description: "Generic function that keeps types intact.",
          code: `function findFirst<T>(arr: T[], value: T) { return arr.indexOf(value); }
console.log(findFirst([1,2,3], 2));`,
          run: (input) => 'Demo: see editor output'
        }
      ];

      // fix tab indexing & initial example
      let currentExample = 0;
      function showExample(index) {
        currentExample = index;
        const ex = examples[currentExample];
        document.getElementById('example-title').textContent = ex.title;
        document.getElementById('example-description').textContent = ex.description;
        document.getElementById('example-code').textContent = ex.code;
        // placeholder adjustments by index
        const input = document.getElementById('example-input');
        if (currentExample === 1) input.placeholder = "Enter 'withAddress' or anything else";
        else if (currentExample === 2) input.placeholder = "Enter 'cat' or anything else";
        else if (currentExample === 4) input.placeholder = "Enter 'number' or anything else";
        else input.placeholder = "Enter a string or number";

        // highlight updated code
        if (window.hljs) {
          document.querySelectorAll('pre code').forEach((block) => {
            try { window.hljs.highlightElement(block); } catch (e) {}
          });
        }

        // update tab CSS
        document.querySelectorAll('.tabs .tab, .tabs button.tab').forEach((t, i) => {
          t.classList.toggle('tab-active', i === currentExample);
        });
      }

      function runExample() {
        const input = document.getElementById('example-input').value;
        const out = examples[currentExample].run(input);
        document.getElementById('example-output').textContent = String(out);
      }

      // small helper functions used in example runs (simulated)
      function reLengthOrNumber(name) {
        if (typeof name === 'string') return name.length;
        return name * name;
      }

      // ----------------------------
      // Article toggles
      // ----------------------------
      function toggleArticle(index) {
        const articles = document.querySelectorAll('.article-content');
        const article = articles[index];
        if (!article) return;
        article.classList.toggle('show');

        // rotate the chevron
        const chevrons = document.querySelectorAll('.article header .fa-chevron-down, .article-header .fa-chevron-down');
        // find the correct chevron near this article header
        const header = article.previousElementSibling;
        const chevron = header ? header.querySelector('.fa-chevron-down') : null;
        if (chevron) chevron.classList.toggle('fa-rotate-180');

        // re-highlight in case code blocks revealed
        if (window.hljs) setTimeout(() => {
          article.querySelectorAll('pre code').forEach((block) => {
            try { window.hljs.highlightElement(block); } catch (e) {}
          });
        }, 120);
      }

      // make initial example load
      showExample(0);

      // ----------------------------
      // Mobile menu
      // ----------------------------
      function toggleMobileMenu() {
        const mobileMenu = document.getElementById('mobile-menu');
        if (!mobileMenu) return;
        mobileMenu.classList.toggle('-translate-y-full');
        // also manage pointer events & aria
        const isHidden = mobileMenu.classList.contains('-translate-y-full');
        mobileMenu.setAttribute('aria-hidden', isHidden ? 'true' : 'false');
      }

      // close mobile menu when clicking outside (but ignore button press)
      document.addEventListener('click', function (event) {
        const mobileMenu = document.getElementById('mobile-menu');
        const button = document.getElementById('mobile-menu-button');
        if (!mobileMenu || !button) return;
        const target = event.target;
        if (!mobileMenu.contains(target) && !button.contains(target)) {
          if (!mobileMenu.classList.contains('-translate-y-full')) {
            mobileMenu.classList.add('-translate-y-full');
            mobileMenu.setAttribute('aria-hidden', 'true');
          }
        }
      });

      // ----------------------------
      // Navbar hide on scroll
      // ----------------------------
      let lastScrollTop = 0;
      window.addEventListener('scroll', function () {
        const navbar = document.getElementById('navbar');
        const mobileMenu = document.getElementById('mobile-menu');
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > lastScrollTop && scrollTop > 120) {
          navbar.classList.add('nav-hidden');
          if (mobileMenu) mobileMenu.classList.add('-translate-y-full');
        } else {
          navbar.classList.remove('nav-hidden');
        }
        lastScrollTop = scrollTop;
      });

      // ----------------------------
      // Ace Editor Setup
      // ----------------------------
      let aceEditor = null;
      function setupAce() {
        try {
          aceEditor = ace.edit("ace-editor", {
            mode: "ace/mode/typescript",
            theme: "ace/theme/monokai",
            wrap: true,
            tabSize: 2,
            useWorker: false,
            enableBasicAutocompletion: true,
            enableSnippets: true,
            enableLiveAutocompletion: true,
          });

          // default content
          const defaultCode = `// Try TypeScript-style code (demo run removes types)
function greet(name: string): string {
  return \`Hello, \${name}!\`;
}

console.log(greet("TypeScript"));`;

          aceEditor.setValue(defaultCode, -1);
        } catch (e) {
          console.warn("Ace setup failed:", e);
        }
      }

      // insert example into editor
      function insertExampleIntoEditor(exampleIndex) {
        if (!aceEditor) return;
        const txt = examples[exampleIndex].code + "\n";
        aceEditor.session.insert({row: aceEditor.session.getLength(), column: 0}, "\n" + txt);
        aceEditor.focus();
      }

      // very basic "format" (indent) - just replace tabs with 2 spaces
      function formatEditor() {
        if (!aceEditor) return;
        const content = aceEditor.getValue();
        const formatted = content.replace(/\t/g, '  ');
        aceEditor.setValue(formatted, -1);
      }

      // run code from editor: naive TS-to-JS transform (remove simple type annotations) and eval
      function runEditorCode() {
        if (!aceEditor) return;
        const raw = aceEditor.getValue();

        // naive removal of common TS annotations for demo (NOT production safe)
        let compiled = raw
          .replace(/:\s*string/g, '')
          .replace(/:\s*number/g, '')
          .replace(/:\s*boolean/g, '')
          .replace(/:\s*any/g, '')
          .replace(/<\w+>/g, ''); // remove generics markers like <T>

        // remove interfaces and types (very naive)
        compiled = compiled.replace(/interface\s+[^{]+\{[^}]*\}/g, '')
                           .replace(/type\s+[^\n]+=/g, '');

        // capture console
        const outputEl = document.getElementById('output-code');
        let out = '';
        const originalLog = console.log;
        console.log = function(...args) {
          out += args.map(a => String(a)).join(' ') + '\n';
        };

        try {
          // run in new function scope
          new Function(compiled)();
          if (!out) out = 'Code executed successfully (no direct console output).';
        } catch (err) {
          out = 'Error: ' + (err && err.message ? err.message : String(err));
        } finally {
          console.log = originalLog;
        }

        outputEl.textContent = out;
      }

      // initialize ace after script load
      window.addEventListener('load', () => {
        setupAce();
        // highlight code blocks
        if (window.hljs) {
          document.querySelectorAll('pre code').forEach((block) => {
            try { window.hljs.highlightElement(block); } catch (e) {}
          });
        }
      });

      // ----------------------------
      // Chatbot UI (local/canned)
      // ----------------------------
      const chatDrawer = document.getElementById('chat-drawer');
      const chatBody = document.getElementById('chat-body');
      function openChat() {
        if (!chatDrawer) return;
        chatDrawer.style.transform = 'translateY(0)';
        chatDrawer.style.opacity = '1';
        chatDrawer.style.pointerEvents = 'auto';
        document.getElementById('chat-input').focus();
      }
      function closeChat() {
        if (!chatDrawer) return;
        chatDrawer.style.transform = 'translateY(8px)';
        chatDrawer.style.opacity = '0';
        chatDrawer.style.pointerEvents = 'none';
      }
      // open via header button(s)
      document.getElementById('chat-open-btn')?.addEventListener('click', openChat);
      document.getElementById('chat-open-mobile')?.addEventListener('click', openChat);

      function appendChat(message, who='bot') {
        if (!chatBody) return;
        const wrap = document.createElement('div');
        wrap.className = 'chat-message p-3 rounded-lg mb-3 ' + (who === 'user' ? 'user self-end' : 'bot');
        wrap.innerHTML = `<div class="text-sm ${who==='user' ? 'text-slate-800' : 'text-slate-700'}">${message}</div>`;
        chatBody.appendChild(wrap);
        chatBody.scrollTop = chatBody.scrollHeight;
      }

      function clearChat() {
        if (!chatBody) return;
        chatBody.innerHTML = '';
      }

      function sendChat() {
        const input = document.getElementById('chat-input');
        const text = input.value.trim();
        if (!text) return;
        appendChat(text, 'user');
        input.value = '';
        // simple canned responses
        setTimeout(() => {
          const reply = cannedReply(text);
          appendChat(reply);
          // special actions if reply contains insert suggestion
          if (reply.includes('[insert example')) {
            // parse index
            const found = reply.match(/\[insert example:(\d)\]/);
            if (found && found[1]) {
              const idx = Number(found[1]);
              insertExampleIntoEditor(idx);
              appendChat('Inserted example into editor. You can edit and run it.');
            }
          }
        }, 550);
      }

      function cannedReply(userText) {
        const t = userText.toLowerCase();
        if (t.includes('union')) return "Union types let a value be multiple types (e.g. `string | number`). Try: [insert example:0]";
        if (t.includes('optional') || t.includes('chaining')) return "Optional chaining `?.` helps when properties may be undefined. Try: [insert example:1]";
        if (t.includes('guard') || t.includes('type guard')) return "Type guards refine types at runtime by returning `value is Type`. Try: [insert example:2]";
        if (t.includes('assert') || t.includes('cast')) return "Type assertions tell the compiler to treat a value as a type — use sparingly.";
        if (t.includes('generics')) return "Generics create reusable typed functions/components. Try: [insert example:4]";
        if (t.includes('run') || t.includes('execute')) return "Click the Run button below the editor to compile (demo) and execute your code.";
        return "I can suggest examples (union, optional chaining, guards, generics) or insert them into the editor. Try: 'Show me generics' or 'Insert union example'.";
      }

      // allow press Enter in chat input
      document.getElementById('chat-input').addEventListener('keydown', function(e){
        if (e.key === 'Enter') { e.preventDefault(); sendChat(); }
      });

      // expose openChat to global for mobile button
      window.openChat = openChat;
      window.closeChat = closeChat;

    </script>
  </body>
</html>
